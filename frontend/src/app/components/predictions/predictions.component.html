<h2>Make a Stock Prediction</h2>

<form (ngSubmit)="submitPrediction()" #predictionForm="ngForm">
  <label for="ticker">Ticker:</label>
  <input type="text" id="ticker" name="ticker" [(ngModel)]="ticker" required>

  <label for="modelType">Model Type:</label>
  <select id="modelType" name="modelType" [(ngModel)]="modelType" required>
    <option value="lstm">LSTM</option>
    <option value="gru">GRU</option>
    <option value="rnn">RNN</option>
  </select>

  <label for="timeline">Prediction Timeline:</label>
  <select id="timeline" name="predictionTimeline" [(ngModel)]="predictionTimeline" required>
    <option value="1d">1 Day</option>
    <option value="2w">2 Weeks</option>
    <option value="2m">2 Months</option>
  </select>

  <button type="submit">Predict</button>
</form>

<div *ngIf="result">
  <h3>Prediction Result</h3>
  <p>Predicted Price: {{ result.predictedPrice }}</p>
</div>

<form class="search-bar" (submit)="onSearchSubmit($event)">
  <label>
    Filter by ticker:
    <input
      name="searchTicker"
      [(ngModel)]="searchTicker"
      maxlength="10"
      placeholder="e.g., AAPL"
      style="text-transform: uppercase"
    />
  </label>
  <button type="submit">Search</button>
  <button type="button" (click)="clearFilter()" *ngIf="searchTicker">Clear</button>
</form>

<div class="predictions-container" *ngIf="predictions.length > 0; else noPredictions">
  <h2 class="header">Your Predictions</h2>

  <div class="prediction-card" *ngFor="let prediction of predictions">
    <div class="card-header">
      <span class="ticker" (click)="navigateToStock(prediction?.ticker)">{{ prediction?.ticker }} <app-info [text]="definitions.ticker"></app-info></span>
      <span class="timeline"><app-info [text]="definitions.predictionTimeline"></app-info>({{ prediction?.predictionTimeline?.toUpperCase() }})</span>
    </div>

    <div class="card-body">
      <p>
        <app-info [text]="definitions.predictedPrice"></app-info>
        <strong> Predicted Price: </strong>
        <ng-container *ngIf="prediction?.predictedPrice !== null && prediction?.predictedPrice !== undefined; else pendingPrice">
          ${{ prediction.predictedPrice | number:'1.2-2' }}
        </ng-container>
        <ng-template #pendingPrice>Pending</ng-template>
      </p>      
      <p><app-info [text]="definitions.modelType"></app-info><strong> Model Type: </strong>{{ prediction?.modelType?.toUpperCase() }}</p>
      <p><app-info [text]="definitions.status"></app-info><strong> Status: </strong>{{ prediction?.status }}</p>
      <p><app-info [text]="definitions.startDate"></app-info>
        <strong> Start Date: </strong>{{ prediction?.startDate | date:'shortDate' }}
      </p>
      <p><app-info [text]="definitions.endDate"></app-info>
        <strong> End Date: </strong>{{ prediction?.endDate ? (prediction.endDate | date:'shortDate') : 'Not available' }}
      </p>
      <p><app-info [text]="definitions.priceDifference"></app-info><strong> Price Difference: </strong>{{ prediction?.priceDifference ? prediction?.priceDifference : 'Pending' }}</p>
      <p><app-info [text]="definitions.predictionAccuracy"></app-info><strong> Prediction Accuracy: </strong>{{ prediction?.predictionAccuracy ? prediction?.predictionAccuracy : 'Pending' }}</p>
      <p>
        <app-info [text]="definitions.actualPrice"></app-info>
        <strong> Actual Price: </strong>
        <ng-container *ngIf="prediction?.actualPrice !== null && prediction?.actualPrice !== undefined; else pendingActual">
          ${{ prediction.actualPrice | number:'1.2-2' }}
        </ng-container>
        <ng-template #pendingActual>Pending</ng-template>
      </p>
    </div>
  </div>
</div>

<ng-template #noPredictions>
  <p class="no-results">You have no predictions yet.</p>
</ng-template>

