<div class="controls">
  <span class="hint">Click a column to sort</span>

  <div class="pager-controls">
    <label>
      Rows per page:
      <select [ngModel]="pageSize()" (ngModelChange)="changePageSize($event)">
        <option *ngFor="let sz of pageSizeOptions" [value]="sz">{{ sz }}</option>
      </select>
    </label>
  </div>
</div>
  
  <table class="predictions-table" *ngIf="sortedPredictions().length; else empty">
    <thead>
      <tr>
        <th (click)="setSort('ticker')" class="sortable">
          Ticker <app-info [text]="definitions.ticker"></app-info>
          <span class="sort">{{ sortIcon('ticker') }}</span>
        </th>
        <th (click)="setSort('modelType')" class="sortable">
          Model Type <app-info [text]="definitions.modelType"></app-info>
          <span class="sort">{{ sortIcon('modelType') }}</span>
        </th>
        <th>
          Sector <app-info [text]="definitions.sector"></app-info>
        </th>
        <th (click)="setSort('predictionTimeline')" class="sortable">
          Prediction Length <app-info [text]="definitions.predictionTimeline"></app-info>
          <span class="sort">{{ sortIcon('predictionTimeline') }}</span>
        </th>
        <th>
          Status <app-info [text]="definitions.status"></app-info>
        </th>
        <th>
          Start <app-info [text]="definitions.startDate"></app-info>
        </th>
        <th>
          End <app-info [text]="definitions.endDate"></app-info>
        </th>
        <th>
          Predicted <app-info [text]="definitions.predictedPrice"></app-info>
        </th>
        <th>
          Mean Squared Error <app-info [text]="definitions.mse"></app-info>
        </th>
      </tr>
    </thead>
  
    <tbody>
      <tr *ngFor="let p of pagedPredictions(); trackBy: trackByRow" class="row">
        <td class="ticker">
          <a [routerLink]="['/stock', p.ticker]">{{ p.ticker }}</a>
        </td>
  
        <td>
          <span class="badge badge-model">{{ p.modelType.toUpperCase() }}</span>
        </td>

        <td>
          <span class="sector">{{ p.sector }}</span>
        </td>
  
        <td>
          <span class="badge badge-timeline">{{ p.predictionTimeline.toUpperCase() }}</span>
        </td>
  
        <td>
          <span
            class="status"
            [ngClass]="{
              completed: (p.status || '').toLowerCase() === 'completed',
              pending:   (p.status || '').toLowerCase() === 'pending'
            }"
          >
            {{ p.status }}
          </span>
        </td>
  
        <td>{{ p.startDate | date: 'shortDate' }}</td>
  
        <td>{{ p.endDate ? (p.endDate | date:'shortDate') : '—' }}</td>
  
        <td class="numeric">
          <ng-container *ngIf="p.predictedPrice !== null && p.predictedPrice !== undefined; else dash">
            {{ p.predictedPrice | currency:'USD':'symbol':'1.2-2' }}
          </ng-container>
          <ng-template #dash>—</ng-template>
        </td>
  
        <td class="numeric">
          <ng-container *ngIf="p.mse !== null && p.mse !== undefined; else dash2">
            <span
              class="accuracy"
              [ngClass]="{
                good: p.mse >= 66,
                meh:  p.mse >= 33 && p.mse < 66,
                bad:  p.mse < 33
              }"
            >
              {{ p.mse | number:'1.2-7' }}
            </span>
          </ng-container>
          <ng-template #dash2>—</ng-template>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="pagination-bar" *ngIf="totalItems() > 0">
    <div class="range">
      {{ pageBounds().from }}–{{ pageBounds().to }} of {{ pageBounds().total }}
    </div>
  
    <div class="buttons">
      <button (click)="prevPage()" [disabled]="page() === 1">Prev</button>
  
      <button
        *ngFor="let n of pageNumbers()"
        (click)="goToPage(n)"
        [class.active]="page() === n">
        {{ n }}
      </button>
  
      <button (click)="nextPage()" [disabled]="page() === totalPages()">Next</button>
    </div>
  </div>
  
  <ng-template #empty>
    <p class="empty">No predictions yet.</p>
  </ng-template>
  